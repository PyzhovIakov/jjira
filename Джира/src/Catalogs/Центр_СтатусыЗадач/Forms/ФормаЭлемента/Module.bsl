
&НаКлиенте
Процедура ВыбратьЦвет(Команда)
    ОткрытьФормуВыбораЦвета("ЦветHEX", "ЦветRGB", "ЦветТекстаRGB"); 
КонецПроцедуры

&НаКлиенте
Процедура ЦветОчистка(Элемент, СтандартнаяОбработка)
	Элементы.Цвет.ЦветФона = Новый Цвет();
КонецПроцедуры

&НаКлиенте
Процедура ЦветПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ЦветПредставлениеНачалоВыбора(Элемент, ДанныеВыбора, ВыборДобавлением, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
    ОткрытьФормуВыбораЦвета("ЦветHEX", "ЦветRGB", "ЦветТекстаRGB"); 

КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуВыбораЦвета(ИмяРеквизитаЦветаHEX, ИмяРеквизитаЦветаRGB = "", ИмяРеквизитаЦветаТекстаRGB = "")

	ОткрытьФорму("ОбщаяФорма.Центр_ФормаВыбораЦвета", 
		Новый Структура("Цвет", Объект[ИмяРеквизитаЦветаHEX]), 
		ЭтотОбъект,,,, 
		Новый ОписаниеОповещения("ВыполнитьПослеЗакрытияФормыВыбораЦвета", ЭтотОбъект, 
			Новый Структура("ИмяРеквизитаЦветаHEX, ИмяРеквизитаЦветаRGB, ИмяРеквизитаЦветаТекстаRGB", 
				ИмяРеквизитаЦветаHEX, ИмяРеквизитаЦветаRGB, ИмяРеквизитаЦветаТекстаRGB
			)
		)
	); 
	
	
КонецПроцедуры 

&НаКлиенте
Процедура ВыполнитьПослеЗакрытияФормыВыбораЦвета(ВыбранноеЗначение, ДополнительныеПараметры) Экспорт
	
	Если ВыбранноеЗначение = Неопределено ИЛИ НЕ ЗначениеЗаполнено(ВыбранноеЗначение) ИЛИ ВыбранноеЗначение = КодВозвратаДиалога.Отмена Тогда
		Возврат;	
	КонецЕсли; 	
	
	//Модифицированность = Истина;      
	
	///////////////////////////// Цвет фона/текста в HEX	
	ИмяРеквизитаЦветаHEX 			= ДополнительныеПараметры.ИмяРеквизитаЦветаHEX;
	Объект[ИмяРеквизитаЦветаHEX] 	= ВыбранноеЗначение.ЦветHEX;         
	
	///////////////////////////// Цвет фона/текста в RGB (для фона элемента формы)
	
	ЦветФона = Новый Цвет(ВыбранноеЗначение.ЦветRGB.R, ВыбранноеЗначение.ЦветRGB.G, ВыбранноеЗначение.ЦветRGB.B);  
	
	Элементы.ФормаВыбратьЦвет.ЦветФона = ЦветФона;
		                      
	МассивЧастейЦвета = Новый Массив;
	МассивЧастейЦвета.Добавить(ВыбранноеЗначение.ЦветRGB.R);
	МассивЧастейЦвета.Добавить(ВыбранноеЗначение.ЦветRGB.G);
	МассивЧастейЦвета.Добавить(ВыбранноеЗначение.ЦветRGB.B); 
	
	Объект[ДополнительныеПараметры.ИмяРеквизитаЦветаRGB] = СтрСоединить(МассивЧастейЦвета, ",");
	
	МассивЧастейЦвета = Новый Массив;
	МассивЧастейЦвета.Добавить(ВыбранноеЗначение.ЦветТекстаRGB.R);
	МассивЧастейЦвета.Добавить(ВыбранноеЗначение.ЦветТекстаRGB.G);
	МассивЧастейЦвета.Добавить(ВыбранноеЗначение.ЦветТекстаRGB.B);  
	
	Объект[ДополнительныеПараметры.ИмяРеквизитаЦветаТекстаRGB] = СтрСоединить(МассивЧастейЦвета, ",");
	
	ЦветТекста = Новый Цвет(ВыбранноеЗначение.ЦветТекстаRGB.R, ВыбранноеЗначение.ЦветТекстаRGB.G, ВыбранноеЗначение.ЦветТекстаRGB.B);  
	
	Элементы.ФормаВыбратьЦвет.ЦветТекста = ЦветТекста;
	//ЦветКрасный = ВыбранноеЗначение.ЦветТекстаRGB.R;
	//ЦветЗеленый = ВыбранноеЗначение.ЦветТекстаRGB.G;
	//ЦветСиний = ВыбранноеЗначение.ЦветТекстаRGB.B;
	
КонецПроцедуры


&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка) 
	Если ЗначениеЗаполнено(Объект.ЦветRGB) тогда
		Фон = СтрРазделить(Объект.ЦветRGB,",");	
		Элементы.ФормаВыбратьЦвет.ЦветФона = Новый Цвет(Фон[0],Фон[1],Фон[2]);	
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ЦветТекстаRGB) тогда
		ЦветТекста = СтрРазделить(Объект.ЦветТекстаRGB,",");	
		Элементы.ФормаВыбратьЦвет.ЦветТекста = Новый Цвет(ЦветТекста[0],ЦветТекста[1],ЦветТекста[2]);	
	КонецЕсли; 		
КонецПроцедуры



&НаКлиенте
Процедура ЗакрытПриИзменении(Элемент)
	Если Объект.Закрыт Тогда
		Объект.Новый = Ложь;		
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура НовыйПриИзменении(Элемент)
	Если Объект.Новый Тогда
		Объект.Закрыт = Ложь;
	КонецЕсли;
КонецПроцедуры



